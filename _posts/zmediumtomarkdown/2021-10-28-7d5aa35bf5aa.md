---
title: ç¾ä»£åŒ– Androidâ€Šâ€”â€ŠJetpack Compose Part 2- Rendering And State
author: Roy Huang
date: 2021-10-28T03:26:59.583+0000
last_modified_at: 2021-10-28T07:50:06.756+0000
categories: Pinkoi Engineering
tags: [pinkoi,android,jetpack-compose,rendering]
description: ä¸Šä¸€ç¯‡ç°¡å–®çš„ä»‹ç´¹äº† Compose å’Œç”¨æ³•ï¼Œä½†ç¾å¯¦ä¸–ç•Œä¸­å…¶å¯¦æ²’æœ‰é€™éº¼ç°¡å–®ï¼Œä¸æœƒåªæ˜¯å–®å–®çš„å‘ˆç¾é è¨­çš„æ–‡å­—æˆ–å‹•ä½œï¼Œå¾€å¾€é‚„éœ€è¦æ ¹æ“šä½¿ç”¨è€…äº’å‹•ä¾†æ›´æ–°ç•«é¢ï¼Œåƒæ˜¯é»æ“ŠæŒ‰éˆ•ã€å‘¼å« API æ›´æ–°è³‡æ–™ç­‰ã€‚
image:
  path: assets/7d5aa35bf5aa/0*y0IceFc-kfHol4So
render_with_liquid: false
---

### ç¾ä»£åŒ– Android â€” Jetpack Compose Part 2 â€” Rendering And State


![Photo by [Rodion Kutsaev](https://unsplash.com/@frostroomhead?utm_source=medium&utm_medium=referral){:target="_blank"} on [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral){:target="_blank"}](/assets/7d5aa35bf5aa/0*y0IceFc-kfHol4So)

Photo by [Rodion Kutsaev](https://unsplash.com/@frostroomhead?utm_source=medium&utm_medium=referral){:target="_blank"} on [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral){:target="_blank"}

[ä¸Šä¸€ç¯‡](../f436fd3ccc41/) ç°¡å–®çš„ä»‹ç´¹äº† Compose å’Œç”¨æ³•ï¼Œä½†ç¾å¯¦ä¸–ç•Œä¸­å…¶å¯¦æ²’æœ‰é€™éº¼ç°¡å–®ï¼Œä¸æœƒåªæ˜¯å–®å–®çš„å‘ˆç¾é è¨­çš„æ–‡å­—æˆ–å‹•ä½œï¼Œå¾€å¾€é‚„éœ€è¦æ ¹æ“šä½¿ç”¨è€…äº’å‹•ä¾†æ›´æ–°ç•«é¢ï¼Œåƒæ˜¯é»æ“ŠæŒ‰éˆ•ã€å‘¼å« API æ›´æ–°è³‡æ–™ç­‰ã€‚

é€™ç¯‡è¦ä¾†ä»‹ç´¹åœ¨ Compose çš„ä¸–ç•Œè£¡è¦æ€éº¼è®“ Composable è¨˜æ†¶ç‹€æ…‹ä»¥åŠå’Œä½¿ç”¨è€…äº’å‹•ã€‚
### é‚£è©²æ€éº¼åšï¼Ÿ


> é€é ã€ŒStateã€ä¾†é”æˆ 





åœ¨äº†è§£ State ä¹‹å‰æˆ‘å€‘è¦å…ˆçŸ¥é“ Compose æ˜¯å¦‚ä½•æ¸²æŸ“\(Rendering\)çš„ï¼Œåœ¨å®˜æ–¹æ–‡ä»¶ä¸­é€™æ˜¯åˆ†æˆå…©å€‹ç« ç¯€ï¼Œä½†æˆ‘å€‹äººè¦ºå¾—è¦å…ˆäº†è§£ Rendering åœ¨çœ‹ state æœƒæ¯”è¼ƒæ¸…æ¥šã€‚
#### View æ¸²æŸ“\(Rendering\)

å…ˆå›é¡§ç›®å‰çš„ View æ˜¯å¦‚ä½• Rendering çš„?æˆ‘å€‘çŸ¥é“ä¸€å€‹ View ä»–æœƒç¶“éé€™æ¨£çš„éç¨‹ï¼š
```
onMeasure -> onLayout -> onDraw
```

ç„¶å¾Œå¦‚æœè¦å†æ›´æ–° View æ™‚å¯ä»¥å‘¼å« **invalidate\( \)**
#### Compose æ€éº¼åš?

ä»¥ä¸‹æ“·å–å®˜æ–¹çš„èªªæ˜å’Œåœ–ç‰‡ä¾†è§£é‡‹


![[https://developer\.android\.com/jetpack/compose/lifecycle](https://developer.android.com/jetpack/compose/lifecycle){:target="_blank"}](/assets/7d5aa35bf5aa/1*OXbrTCCdzuW9FF55gQrWxQ.png)

[https://developer\.android\.com/jetpack/compose/lifecycle](https://developer.android.com/jetpack/compose/lifecycle){:target="_blank"}


> When Jetpack Compose runs your composables for the first time, during _initial composition_ , it will keep track of the composables that you call to describe your UI in a Composition\. 





> Then, when the state of your app changes, Jetpack Compose schedules a _recomposition_ \. Recomposition is when Jetpack Compose re\-executes the composables that may have changed in response to state changes, and then updates the Composition to reflect any changes\. 





> A Composition can only be produced by an initial composition and updated by recomposition\. **The only way to modify a Composition is through recomposition\.** 





ä¸Šé¢èªªäº†é€™éº¼å¤šï¼Œç¸½çµä¸€ä¸‹å°±æ˜¯ï¼š
- Compose ç¬¬ä¸€æ¬¡è·‘æ™‚æœƒæ ¹æ“šä½ çš„ composables çµ„åˆå‡º UI
- ä¹‹å¾Œè®Šå‹•æ™‚æœƒæ ¹æ“šã€Œè³‡æ–™è®Šå‹•ã€å» re\-composition
- **è¦é‡æ–°çµ„åˆ UI å”¯ä¸€æ–¹å¼å°±æ˜¯é‡æ–°çµ„åˆ UI**

#### æ‰€ä»¥æ¯æ¬¡åªè¦è³‡æ–™è®Šå‹•ï¼Œ **Composition** å°±è¦é‡ä¾†ä¸€é?

å°ï¼Œä¹Ÿä¸å°ã€‚æ ¹æ“šå®˜æ–¹æ–‡ä»¶å…§æœ‰æåˆ°ï¼š


> If a composable is already in the Composition, it can skip recomposition if all the inputs are stable and havenâ€™t changed\. 





Compose å®ƒå…¶å¯¦å¾ˆè°æ˜ï¼Œå¦‚æœå®ƒç™¼ç¾è£¡é¢çš„æ¯å€‹ composable éƒ½æ˜¯ç›¸åŒçš„å…§å®¹æ²’è¢«æ›´å‹•éï¼Œé‚£å®ƒå°±æœƒ **ç›´æ¥è·³é** ã€‚

æ—¢ç„¶æˆ‘å€‘äº†è§£ compose æ˜¯é€é composition å’Œ recomposition ä¾†çµ„åˆ UIï¼Œæ¥ä¸‹ä¾†å°±å¯ä»¥ç¹¼çºŒå¾€ä¸‹çœ‹å¦‚ä½•è®“ compose è§¸ç™¼ recompositionã€‚

**State** æ˜¯ Compose å…§ä¸€ç¨®å¯ä»¥è¨˜æ†¶ç‹€æ…‹åœ¨ memory ä¸­çš„å€¼ï¼Œä»–å¯ä»¥è¨˜æ†¶ä»»ä½•çš„å€¼ã€‚

å‡è¨­æˆ‘ä»Šå¤©æœ‰ä¸€å€‹ Compose \(å–è‡³ [å®˜æ–¹](https://developer.android.com/jetpack/compose/state#state-and-composition){:target="_blank"} \)
```
@Composable
fun HelloContent() {
   Column(modifier = Modifier.padding(16.dp)) {
       Text(
           text = "Hello!",
           modifier = Modifier.padding(bottom = 8.dp),
           style = MaterialTheme.typography.h5
       )
       OutlinedTextField(
           value = "",
           onValueChange = { },
           label = { Text("Name") }
       )
   }
}
```

å¦‚æœæ˜¯ä¸Šé¢é€™æ®µç¨‹å¼ç¢¼ï¼Œæˆ‘æƒ³è¦å‹•æ…‹çš„æ”¹è®Š Text çš„å€¼ï¼Œé€™æ™‚å€™å°±è¦åŠ ä¸Š state ï¼Œæ”¹ç‚ºä»¥ä¸‹ \(é»‘ç²—é«”å­—\)ï¼š
```
@Composable
fun HelloContent() {
   Column(modifier = Modifier.padding(16.dp)) {
       var name by remember { mutableStateOf("") }
       if (name.isNotEmpty()) {
           Text(
               text = "Hello, $name!",
               modifier = Modifier.padding(bottom = 8.dp),
               style = MaterialTheme.typography.h5
           )
       }
       OutlinedTextField(
           value = name,
           onValueChange = { name = it },
           label = { Text("Name") }
       )
   }
}
```

é€é remember \+ stateï¼Œç•¶ onValueChange è³¦å€¼çµ¦ name æ™‚ï¼Œå°± **é”æˆäº†ä¸Šé¢æåˆ°çš„ç•¶è³‡æ–™æœ‰è®Šå‹•æ™‚è¦ recomposition çš„æ¢ä»¶** ï¼Œæ‰€ä»¥ compose æœƒå»æ‰¾åˆ°é€™å€‹çµ„åˆä¸­ä¸ä¸€æ¨£çš„åœ°æ–¹ä¸¦ä¸”æ”¹è®Š Text å…§çš„å€¼ã€‚

é€™æ¨£æˆ‘å€‘å°±å®Œæˆäº† Stateful çš„ UIï¼ŒState æœ‰ä¸‰ç¨®å®£å‘Šæ–¹å¼ï¼š
```
- val mutableState = remember { mutableStateOf(default) }
- var value by remember { mutableStateOf(default) }
- val (value, setValue) = remember { mutableStateOf(default) }
```

æ›´å¤šçš„ç·´ç¿’å’Œè³‡è¨Šå¯ä»¥åƒè€ƒ code lab:

[https://developer\.android\.com/codelabs/jetpack\-compose\-state\#0](https://developer.android.com/codelabs/jetpack-compose-state#0){:target="_blank"}

æœ€å¾Œé‚„è¦æåˆ°å¾ˆé‡è¦çš„ **Side\-Effects** ï¼Œç‚ºä»€éº¼ Side\-Effects å¾ˆé‡è¦?å› ç‚ºä¸Šé¢æåˆ°äº† compose æœƒå› ã€Œè³‡æ–™è®Šå‹•ã€è§¸ç™¼ recompositionï¼Œä¹Ÿå› ç‚ºé€™å€‹åŸå› ï¼Œæ‰€ä»¥è¦ç‰¹åˆ¥æ³¨æ„ã€Œè³‡æ–™è®Šå‹•ã€çš„æ™‚æ©Ÿé»ï¼Œåƒæ˜¯ï¼š
- **ä¸èƒ½å¤ ç„¡é™æ¬¡åŸ·è¡Œ**
- **è€—æ™‚åŸ·è¡Œï¼ˆé‹ç®—ã€ç¶²è·¯æ“ä½œï¼‰**
- **ä¸æ˜ç¢ºçš„æ™‚æ©Ÿé» ï¼ˆåƒæ˜¯å…¨åŸŸè®Šæ•¸ï¼‰**


ä½†ç¾å¯¦ä¸–ç•Œä¸­æˆ‘å€‘å¯èƒ½æ²’è¾¦æ³•å®Œå…¨éµå®ˆé€™äº›è¦å‰‡ï¼Œæ‰€ä»¥è‡³å°‘è¦åšåˆ°ä»¥ä¸‹å¹¾é»æ‰æ˜¯åˆç†çš„ side effectï¼š
- åŸ·è¡Œæ™‚æ©Ÿæ˜ç¢ºï¼Œä¾‹å¦‚åœ¨ `Recomposition` æ—¶ï¼Œæˆ–è€…åœ¨ `onMount` ç­‰
- åŸ·è¡Œæ¬¡æ•¸æ˜ç¢ºï¼Œä¸æœƒå†ä¸éœ€è¦çš„æ™‚å€™è¢«åŸ·è¡Œï¼Œä¾‹å¦‚æ¯å¹¾ç§’åœ¨èƒŒæ™¯è¨ˆç®—è³‡æ–™æ™‚ä¹Ÿè§¸ç™¼ `Recomposition`
- ä¸æœƒæœ‰ Memory Leakï¼Œæœ‰å§‹æœ‰çµ‚ï¼Œä¾‹å¦‚ fragment æ¶ˆå¤±æ™‚ä¸æ‡‰è©²ç¹¼çºŒè§¸ç™¼ compose


è¦èƒ½å¤ æ­£ç¢ºçš„ä½¿ç”¨ side effectï¼Œæˆ‘å€‘é‚„éœ€è¦å…ˆäº†è§£ composable çš„ lifecycle


![composable lifecycle](/assets/7d5aa35bf5aa/1*ockr5eOVSZVd3RNETe183g.jpeg)

composable lifecycle

å®˜æ–¹æœ‰æä¾›è¨±å¤šå°æ‡‰çš„ side effect è™•ç†æ–¹å¼ï¼Œåƒæ˜¯ **DisposableEffectã€SideEffectã€rememberã€LaunchedEffect** â€¦ç­‰

è€Œæˆ‘å€‘ä¸Šæ–¹ä»‹ç´¹çš„å°±æ˜¯ä½¿ç”¨äº† remember ä¾†æ“ä½œï¼Œäº†è§£ composable lifecycle æ­é…æ­£ç¢ºè™•ç† side effectï¼Œæ‰èƒ½é¿å… memory leak å’Œæ•ˆèƒ½å‡ºç¾å•é¡Œå“¦ï¼
### çµèª

é€™ç¯‡ä»‹ç´¹äº† compose å¦‚ä½•æ›´æ–° UIï¼Œå’Œæ‡‰è©²æ€éº¼åšï¼Œä¸éç¸½è¦ºå¾—å’Œç¾å¯¦ä¸–ç•Œé‚„æ˜¯å·®äº†ä¸€äº›ï¼Œè¦å¦‚ä½•è®“ compose èˆ‡ viewModel äº’å‹•ï¼Ÿæˆ–æ˜¯è¦æ€éº¼åœ¨å°ˆæ¡ˆä¸­é–‹å§‹æˆ‘çš„ç¬¬ä¸€å€‹ Composeï¼Œé€™äº›éƒ½æ˜¯åˆå­¸ compose æ™‚å¾ˆæƒ³ç­è§£çš„äº‹æƒ…ï¼Œæˆ‘å€‘åœ¨ [ä¸‹ä¸€ç¯‡](../49d279087c39/) ç•¶ä¸­å¾…çºŒã€‚

ç¹¼çºŒçœ‹ Composeï¼š
- [ç¾ä»£åŒ– Android â€” Jetpack Compose Part 3 â€” å°å…¥ç¾æœ‰ UI](../49d279087c39/)


å›é¡§ä¸Šä¸€ç¯‡ï¼š
- [ç¾ä»£åŒ– Android â€” Jetpack Compose Part 1 â€” ç°¡ä»‹](../f436fd3ccc41/)

### å·¥å•†æ™‚é–“

Pinkoi å¼·åŠ›å¾µæ‰ä¸­ï¼Œå¦‚æœä½ å°åšå¥½ä¸€å€‹ç”¢å“å……æ»¿ç†±æƒ…ï¼Œå°æŠ€è¡“æˆé•·å……æ»¿æ¸´æœ›ï¼ŒPinkoi APP åœ˜éšŠæ˜¯ä¸€å€‹èƒ½è®“ä½ å……åˆ†ç™¼æ®çš„èˆå°ï¼Œ [æœŸå¾…ä½ çš„åŠ å…¥](https://www.pinkoi.com/about/careers){:target="_blank"} ğŸ’ª

äº†è§£æ›´å¤š Pinkoi APP Teamï¼š


[![](https://miro.medium.com/v2/resize:fit:1200/1*Bxc0D4UINK2NcZ1p4eR3xA.png)](https://medium.com/pinkoi-engineering/%E9%97%9C%E6%96%BC-pinkoi-app-team-72034defe6b7){:target="_blank"}




_[Post](https://medium.com/pinkoi-engineering/%E7%8F%BE%E4%BB%A3%E5%8C%96-android-jetpack-compose-rendering-and-state-7d5aa35bf5aa){:target="_blank"} converted from Medium by [ZMediumToMarkdown](https://github.com/ZhgChgLi/ZMediumToMarkdown){:target="_blank"}._
