---
title: ç¾ä»£åŒ– Androidâ€Šâ€”â€ŠJetpack Compose Part 3- å°å…¥ç¾æœ‰ UI
author: Roy Huang
date: 2021-10-28T03:27:05.323+0000
last_modified_at: 2021-10-28T07:53:02.194+0000
categories: Pinkoi Engineering
tags: [android,jetpack-compose,migration,pinkoi]
description: ä½ å¯èƒ½å’Œæˆ‘ä¸€æ¨£ï¼Œè¿«ä¸åŠå¾…çš„æƒ³è¦æŠŠ Compose æ‡‰ç”¨åœ¨è‡ªå·±çš„å°ˆæ¡ˆ or å…¬å¸ç”¢å“ä¸Šï¼Œä½†æ˜¯åˆä¸çŸ¥é“æ€éº¼é–‹å§‹ä¸‹æ‰‹ï¼Ÿ
image:
  path: assets/49d279087c39/0*1yqmt4fk0YeAq37I
render_with_liquid: false
---

### ç¾ä»£åŒ– Android â€” Jetpack Compose Part 3 â€” å°å…¥ç¾æœ‰ UI


![Photo by [Markus Winkler](https://unsplash.com/@markuswinkler?utm_source=medium&utm_medium=referral){:target="_blank"} on [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral){:target="_blank"}](/assets/49d279087c39/0*1yqmt4fk0YeAq37I)

Photo by [Markus Winkler](https://unsplash.com/@markuswinkler?utm_source=medium&utm_medium=referral){:target="_blank"} on [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral){:target="_blank"}

ä½ å¯èƒ½å’Œæˆ‘ä¸€æ¨£ï¼Œè¿«ä¸åŠå¾…çš„æƒ³è¦æŠŠ Compose æ‡‰ç”¨åœ¨è‡ªå·±çš„å°ˆæ¡ˆ or å…¬å¸ç”¢å“ä¸Šï¼Œä½†æ˜¯åˆä¸çŸ¥é“æ€éº¼é–‹å§‹ä¸‹æ‰‹ï¼Ÿ

é€™ç¯‡è¦ä»‹ç´¹çš„æ˜¯æˆ‘å€‘å¦‚ä½•æŠŠæ—¢æœ‰çš„å°ˆæ¡ˆã€Œç„¡ç—›ã€å°å…¥ compose ã€‚

ä¸€é–‹å§‹å°å…¥çš„æ–¹å¼å¤§è‡´å¯ä»¥åˆ†ä¸‰ç¨®ï¼š
- **æ–°é é¢ç”¨ compose å¯¦ä½œ**
- **èˆŠé é¢é‡æ§‹æˆ compose**
- **å¾å–®ç¨ custom view é–‹å§‹ä½¿ç”¨ compose**


æˆ‘æœƒæ¨è–¦å¾ã€Œ **å–®ç¨ custom view é–‹å§‹ä½¿ç”¨ compose** ã€é–‹å§‹ï¼ŒåŸå› æ˜¯ compose å¯ä»¥å’Œæ—¢æœ‰çš„ custom view ã€ xml ç„¡ç—›æ··åˆä½¿ç”¨ï¼

æ—¢ä¸æœƒå½±éŸ¿åˆ°åŸæœ‰çš„ view ä¹Ÿä¸éœ€è¦ä¸€æ¬¡åˆ°ä½ï¼Œå¯ä»¥å¾ªåºæ¼¸é€²çš„å°å…¥ composeï¼Œè½èµ·ä¾†æ˜¯ä¸æ˜¯å¾ˆä¸éŒ¯ï¼Ÿé‚£å°±ç›´æ¥å‹•æ‰‹é–‹å§‹å§ï½

\(p\.s\. å»ºè­°è¦å…ˆæŠŠ compose åŸºæœ¬è§€å¿µå¼„æ¸…æ¥šå“¦ï¼\)
### é–‹å§‹æ”¹æ”¹çœ‹

å‡è¨­ä»Šå¤©æˆ‘ä»Šå¤©æœ‰ä¸€å€‹ custom view å« `ProductCardView`
```
class ProductCardView @JvmOverloads constructor(
    context: Context,
    attrs: AttributeSet? = null,
    defStyle: Int = 0
) : View(context, attrs, defStyle) {

    fun setData(btnText:String, onClickListener: () -> Unit) {
        this.text = btnText
        this.setOnClickListener(onClickListener)
    }
}
```

é€™å€‹ View æ˜¯ä¸€å€‹ç°¡å–®çš„ `å•†å“å¡ç‰‡ view` ï¼Œè£¡é¢æœ‰ä¸€å€‹ `setData()` çš„æ–¹æ³•å¯ä»¥è¨­ç½®æŒ‰éˆ•æ–‡å­—å’Œ onClickListenerã€‚

æ¥ä¸‹ä¾†æˆ‘è¦æŠŠå®ƒæ”¹ç‚º composeï½
#### Step 1 : å…ˆç”¨ compose åˆ»å‡ºé€™å€‹ ProductCardView

æˆ‘å€‘éœ€è¦å…ˆä¾ç…§é€™å€‹ ProductCardView åŸæœ¬åœ¨ xml æ˜¯ä»€éº¼æ¨¡æ¨£ï¼Œè©¦è‘—ç”¨ compose åšå‡ºä¸€å€‹ä¸€æ¨£çš„ UIã€‚\( [åŒå…ˆå‰æ–‡ç« ](../f436fd3ccc41/) åˆ»å‡ºå•†å“å¡ UIï¼Œé€™é‚Šä¸å¤šè§£é‡‹\)
```
@Composable
fun GridProductCard(
  name: String = "Star War IIIStar War IIIStar War IIIStar War IIIStar War IIIStar War III",
  click: () -> Unit
) {
  ComposeDemoActivityTheme {
    // A surface container using the 'background' color from the theme
    Surface(color = MaterialTheme.colors.background) {

      Column(
        modifier = Modifier
          .padding(10.dp)
          .fillMaxWidth()
          .clickable {
            click.invoke()
          }
      ) {
        Box {
          Image(
            modifier = Modifier.fillMaxWidth(),
            contentScale = ContentScale.Crop,
            painter = painterResource(id = drawable.ic_launcher_background),
            contentDescription = ""
          )
          Image(
            modifier = Modifier
              .align(Alignment.TopStart)
              .padding(all = 10.dp),
            painter = painterResource(id = drawable.baseline_check_circle_outline_red_300_24dp),
            contentDescription = ""
          )
          Image(
            modifier = Modifier
              .align(Alignment.BottomEnd)
              .padding(all = 10.dp),
            painter = painterResource(id = drawable.baseline_thumb_up_cyan_300_24dp),
            contentDescription = ""
          )
        }


        Text(
          modifier = Modifier
            .padding(0.dp, 4.dp, 0.dp, 0.dp)
            .height(40.dp),
          fontSize = 14.sp,
          text = name,
          maxLines = 2,
          overflow = TextOverflow.Ellipsis
        )

        Row(modifier = Modifier.padding(0.dp, 4.dp)) {
          Text(text = "Shop Name", fontSize = 14.sp)
          Text(text = "ãƒ»", fontSize = 14.sp)
          Text(text = "AD", fontSize = 14.sp)
        }
        Row() {
          Text(text = "NT$1,250", fontSize = 14.sp)
          Text(
            fontSize = 14.sp,
            text = "NT$5,000",
            style = TextStyle(textDecoration = TextDecoration.LineThrough),
            color = Color.Gray,
            modifier = Modifier.padding(10.dp, 0.dp)
          )
        }
      }

    }
  }
}
```
#### Step 2 : æŠŠåŸæœ‰çš„ custom view æ”¹æˆ compose çš„æ¨£å­
- é¦–å…ˆæˆ‘å€‘è¦æŠŠåŸæœ‰ç¹¼æ‰¿ `View` æ”¹æˆç¹¼æ‰¿ `AbstractComposeView`
- æ¥ä¸‹ä¾†ä¾ç…§å…ˆå‰å­¸éçš„è§€å¿µï¼Œè®“ compose æ˜¯ Stateful çš„ï¼Œæˆ‘å€‘éœ€è¦æŠŠ `text` å’Œ `onClickListener` æ”¹ç‚º `mutableStateOf` ä¸¦ä¸”å‚³é€²å»çµ¦å¯«å¥½çš„ `Composable` å…§

```
class ProductCardView @JvmOverloads constructor(
    context: Context,
    attrs: AttributeSet? = null,
    defStyle: Int = 0
) : AbstractComposeView(context, attrs, defStyle) {

    var text by mutableStateOf<String>("")
    var onClick by mutableStateOf<() -> Unit>({})
    fun setData(btnText:String, onClickListener:() -> Unit) {
        this.text = btnText
        this.onClick = onClickListener
    }
```
#### Step 3 : æŠŠ Step 1 çš„æ±è¥¿æ”¾é€² Step 2 çš„ Content\( \) å…§

æŠŠä¸Šé¢å…©æ­¥é©Ÿåˆåœ¨ä¸€èµ·å§ï¼
```
class ProductCardView @JvmOverloads constructor(
    context: Context,
    attrs: AttributeSet? = null,
    defStyle: Int = 0
) : AbstractComposeView(context, attrs, defStyle) {

    var text by mutableStateOf<String>("")
    var onClick by mutableStateOf<() -> Unit>({})
    fun setData(btnText:String, onClickListener:() -> Unit) {
        this.text = btnText
        this.onClick = onClickListener
    }
```
#### Step 4 : æ¸¬è©¦æ˜¯å¦æ­£å¸¸

æ²’éŒ¯ï¼Œåšå®Œä¸Šé¢çš„è©±å°±å·²ç¶“æŠŠæ—¢æœ‰çš„ view æ”¹ç‚º compose äº† ğŸŠï¼Œæˆ‘å€‘å¯ä»¥å›åˆ°ä½¿ç”¨ view çš„åœ°æ–¹çœ‹çœ‹æ˜¯ä¸æ˜¯å¯ä»¥æ­£å¸¸åŸ·è¡Œï¼Œä¸€èˆ¬ä¾†èªªæ˜¯å¯ä»¥ç„¡ç¸«æ¥è»Œä¸éœ€è¦æ”¹å¤–é¢èª¿ç”¨çš„åœ°æ–¹çš„ï¼Œä¾‹å¦‚ï¼š
```
class ExampleActivity : Activity() {

    private lateinit var binding: ActivityExampleBinding

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        binding = ActivityExampleBinding.inflate(layoutInflater)
        setContentView(binding.root)

        binding.productCardView.setData(
            btnText = getString(R.string.something)
            onClickListener = { /* Do something */ }
        )
    }
}
```
#### é¡å¤–è£œå……

å¦‚æœæˆ‘çš„ custom view è£¡é¢æœ‰ç”¨åˆ°åˆ¥çš„ custom viewï¼Œä½†æ˜¯æˆ‘ä¸æƒ³è¦ç¾åœ¨å…¨éƒ¨æ”¹ç‚º compose æ€éº¼è¾¦ï¼Ÿåˆ¥æ“”å¿ƒï¼Œ compose ç‚ºäº†è®“ä½ ç„¡ç—›æ¥è»Œ\(?\) æ‰€ä»¥ä¹Ÿæœ‰æä¾› `AndroidView` é€™å€‹ `Composable` ï¼Œç”¨é€”æ˜¯ä½ å¯ä»¥ **ç›´æ¥å¼•ç”¨æ—¢æœ‰çš„ view åˆ° compose å…§** ï¼

æ‹¿ä¸Šé¢çš„ç¯„ä¾‹ä¾†èªªï¼Œå¦‚æœæˆ‘çš„ `GridProductCard` å°±æ˜¯æƒ³è¦åœ¨è£¡é¢æ”¾ `ImageView` ï¼Œé‚£éº¼ä½ å¯ä»¥é€™æ¨£åšï¼š
```
@Composable
fun GridProductCard(
    text: String,
    onClick: () -> Unit
) {
        AndroidView(
            factory = { context ->
                ImageView(context)
            }, 
            update = {
               it.setImageResource(R.drawable.your_image)
            }
        )

}
```

AndroidView å…§ä¸»è¦æœ‰å…©å€‹é‡é»åƒæ•¸ï¼š
- `factory` ï¼šç”¨ä»¥å‘Šè¨´ compose ä½ è¦æ”¾å…¥ä»€éº¼ view
- `update` ï¼šä½ è¦å°é€™å€‹ view åšä»€éº¼æ“ä½œ


å®Œæ•´ç¯„ä¾‹å¯åƒè€ƒ GitHub Repoï¼š


[![](https://opengraph.githubassets.com/202c97ca66323dcc82363ee24d92df50bd57b01d2f5f1cb78b0d0b754d431919/pinkoi-inc/Android-Compose-Demo)](https://github.com/pinkoi-inc/Android-Compose-Demo/blob/master/app/src/main/java/com/roy/compose/HybridViewDemoActivity.kt){:target="_blank"}


çœ‹èµ·ä¾†å¾ˆç°¡å–®å§ï¼Œç•¶ç„¶ä¸Šé¢é€™æ˜¯ä¸€å€‹ç°¡å–®çš„ä¾‹å­ï¼Œå¯¦éš›ä¸Šå¦‚æœæœ‰å¯¦è¸ä¸€äº› Design Pattern ä¾‹å¦‚ MVPã€MVVM çš„è©±ï¼Œæˆ‘å€‘å¸¸å¸¸æœƒéœ€è¦èˆ‡ ViewModel æˆ– Presenter äº’å‹•å”ä½œï¼Œåˆæˆ–æ˜¯æœ‰ç”¨åˆ° DIã€Paging ç­‰å¤–éƒ¨ Lib æ™‚è©²æ€éº¼åšå‘¢ï¼Ÿ

å»ºè­°å¯ä»¥åƒè€ƒå®˜æ–¹èªªæ˜ sample å¦‚ä¸‹ï¼š

[https://developer\.android\.com/jetpack/compose/libraries](https://developer.android.com/jetpack/compose/libraries){:target="_blank"}
### çµèª

ä½¿ç”¨ Compose é›–ç„¶ä¸€é–‹å§‹å¯èƒ½æœ‰ä¸€äº›å­¸ç¿’æˆæœ¬ï¼Œä½†æ˜¯ä¸Šæ‰‹å¾Œæœƒç™¼ç¾ç”¨ Compose åˆ» UI æ˜¯éå¸¸çš„ç°¡æ½”ï¼Œæ²’æœ‰éå¤šç¹¼æ‰¿ã€è¤‡é›œçš„ xml çµæ§‹éœ€è¦äº†è§£ï¼Œä¸” Compose å’Œ Flutter å’Œ Swift UI éå¸¸çš„åƒï¼ˆæˆ‘è½èªªçš„ï¼‰ï¼Œç­‰æ–¼å­¸ä¸€å¥—å°±å¯ä»¥æœƒå¾ˆå¤šç¨®ï½æ‡‰è©²æ˜¯å¥½è™•å¤šå¤šï¼Œå»ºè­°å¤§å®¶è‹¥é‚„åœ¨è§€æœ›çš„è©±å¯ä»¥é–‹å§‹è©¦è©¦çœ‹ï¼

Ref:

[https://developer\.android\.com/jetpack/compose/interop/compose\-in\-existing\-arch](https://developer.android.com/jetpack/compose/interop/compose-in-existing-arch){:target="_blank"}

å›é¡§ä¸Šä¸€ç¯‡ï¼š
- [ç¾ä»£åŒ– Android â€” Jetpack Compose Part 1 â€” ç°¡ä»‹](../f436fd3ccc41/)
- [ç¾ä»£åŒ– Android â€” Jetpack Compose Part 2 â€” Rendering And State](../7d5aa35bf5aa/)

### å·¥å•†æ™‚é–“

Pinkoi å¼·åŠ›å¾µæ‰ä¸­ï¼Œå¦‚æœä½ å°åšå¥½ä¸€å€‹ç”¢å“å……æ»¿ç†±æƒ…ï¼Œå°æŠ€è¡“æˆé•·å……æ»¿æ¸´æœ›ï¼ŒPinkoi APP åœ˜éšŠæ˜¯ä¸€å€‹èƒ½è®“ä½ å……åˆ†ç™¼æ®çš„èˆå°ï¼Œ [æœŸå¾…ä½ çš„åŠ å…¥](https://www.pinkoi.com/about/careers){:target="_blank"} ğŸ’ª

äº†è§£æ›´å¤š Pinkoi APP Teamï¼š


[![](https://miro.medium.com/v2/resize:fit:1200/1*Bxc0D4UINK2NcZ1p4eR3xA.png)](https://medium.com/pinkoi-engineering/%E9%97%9C%E6%96%BC-pinkoi-app-team-72034defe6b7){:target="_blank"}




_[Post](https://medium.com/pinkoi-engineering/%E7%8F%BE%E4%BB%A3%E5%8C%96-android-jetpack-compose-%E5%B0%8E%E5%85%A5%E7%8F%BE%E6%9C%89-ui-49d279087c39){:target="_blank"} converted from Medium by [ZMediumToMarkdown](https://github.com/ZhgChgLi/ZMediumToMarkdown){:target="_blank"}._
